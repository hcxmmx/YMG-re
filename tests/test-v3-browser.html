<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MessageBuilder V3 æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        
        .container {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        h1 { color: #1e293b; margin-bottom: 24px; }
        h2 { color: #334155; margin-top: 32px; margin-bottom: 16px; }
        
        .status { padding: 12px; border-radius: 8px; margin: 12px 0; }
        .status.success { background: #dcfce7; color: #16a34a; border: 1px solid #bbf7d0; }
        .status.error { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .status.warning { background: #fefce8; color: #ca8a04; border: 1px solid #fef3c7; }
        .status.info { background: #eff6ff; color: #2563eb; border: 1px solid #dbeafe; }
        
        .input-group {
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
        }
        
        button {
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 12px;
            margin-bottom: 8px;
        }
        
        button:hover { background: #2563eb; }
        button:disabled { background: #9ca3af; cursor: not-allowed; }
        
        .file-drop {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 32px;
            text-align: center;
            color: #64748b;
            margin-bottom: 16px;
            transition: all 0.3s;
        }
        
        .file-drop.dragover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 16px;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #64748b;
        }
        
        .tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 16px 0;
        }
        
        .stat-card {
            background: #f8fafc;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1e293b;
        }
        
        .stat-label {
            color: #64748b;
            font-size: 12px;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ MessageBuilder V3 æ¶æ„æµ‹è¯•</h1>
        <div class="status info">
            åŸºäºSillyTavernæ¶æ„çš„ç°ä»£åŒ–æ¶ˆæ¯æ„å»ºå™¨æµ‹è¯•å¹³å°
        </div>
    </div>

    <div class="container">
        <h2>ğŸ“ é¢„è®¾æ–‡ä»¶æµ‹è¯•</h2>
        
        <div class="file-drop" id="fileDropZone">
            <div>ğŸ“„ æ‹–æ‹½ä½ çš„SillyTaverné¢„è®¾æ–‡ä»¶åˆ°è¿™é‡Œ</div>
            <div style="margin-top: 8px; font-size: 12px;">æˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶</div>
        </div>
        
        <input type="file" id="fileInput" accept=".json" style="display: none;">
        <button onclick="document.getElementById('fileInput').click()">é€‰æ‹©é¢„è®¾æ–‡ä»¶</button>
        <button onclick="loadSamplePreset()">ä½¿ç”¨ç¤ºä¾‹é¢„è®¾</button>
        <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        
        <div id="presetInfo" style="margin-top: 16px;"></div>
    </div>

    <div class="container" id="resultsContainer" style="display: none;">
        <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
        
        <div class="stats" id="statsContainer"></div>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('analysis')">ç»“æ„åˆ†æ</div>
            <div class="tab" onclick="showTab('gemini')">Geminiè½¬æ¢</div>
            <div class="tab" onclick="showTab('openai')">OpenAIè½¬æ¢</div>
            <div class="tab" onclick="showTab('performance')">æ€§èƒ½æµ‹è¯•</div>
        </div>
        
        <div id="analysis" class="tab-content active">
            <div id="analysisContent"></div>
        </div>
        
        <div id="gemini" class="tab-content">
            <div id="geminiContent"></div>
        </div>
        
        <div id="openai" class="tab-content">
            <div id="openaiContent"></div>
        </div>
        
        <div id="performance" class="tab-content">
            <div id="performanceContent"></div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let currentPreset = null;
        let testResults = null;

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // æ–‡ä»¶æ‹–æ‹½å¤„ç†
        const fileDropZone = document.getElementById('fileDropZone');
        const fileInput = document.getElementById('fileInput');

        fileDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileDropZone.classList.add('dragover');
        });

        fileDropZone.addEventListener('dragleave', () => {
            fileDropZone.classList.remove('dragover');
        });

        fileDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            fileDropZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // æ–‡ä»¶å¤„ç†
        function handleFile(file) {
            if (!file.name.toLowerCase().endsWith('.json')) {
                showStatus('error', 'è¯·é€‰æ‹©JSONæ ¼å¼çš„é¢„è®¾æ–‡ä»¶');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const presetData = JSON.parse(e.target.result);
                    processPreset(presetData, file.name);
                } catch (error) {
                    showStatus('error', `æ–‡ä»¶è§£æå¤±è´¥: ${error.message}`);
                }
            };
            reader.readAsText(file);
        }

        // åŠ è½½ç¤ºä¾‹é¢„è®¾
        function loadSamplePreset() {
            const samplePreset = {
                "name": "V3æ¶æ„æµ‹è¯•é¢„è®¾",
                "description": "ç”¨äºæµ‹è¯•MessageBuilder V3çš„ç¤ºä¾‹é¢„è®¾",
                "prompts": [
                    {
                        "identifier": "main_system",
                        "name": "ä¸»è¦ç³»ç»Ÿæç¤ºè¯",
                        "content": "ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„AIåŠ©æ‰‹ï¼Œè¯·å‹å–„åœ°å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚",
                        "enabled": true,
                        "role": "system",
                        "injection_depth": 0,
                        "injection_order": 1,
                        "injection_position": 0
                    },
                    {
                        "identifier": "character_card",
                        "name": "è§’è‰²æè¿°",
                        "content": "è§’è‰²åï¼šæ™ºèƒ½åŠ©æ‰‹\\næ€§æ ¼ï¼šå‹å–„ã€ä¸“ä¸šã€çŸ¥è¯†æ¸Šåš\\nèƒŒæ™¯ï¼šæˆ‘æ˜¯ä¸€ä¸ªAIåŠ©æ‰‹ï¼Œä¸“é—¨å¸®åŠ©ç”¨æˆ·è§£ç­”é—®é¢˜",
                        "enabled": true,
                        "role": "system",
                        "injection_depth": 1,
                        "injection_order": 10,
                        "injection_position": 0
                    },
                    {
                        "identifier": "example_dialog",
                        "name": "ç¤ºä¾‹å¯¹è¯",
                        "content": "Human: ä½ å¥½\\nAssistant: ä½ å¥½ï¼æˆ‘æ˜¯æ™ºèƒ½åŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ",
                        "enabled": true,
                        "role": "user",
                        "injection_depth": 2,
                        "injection_order": 20,
                        "injection_position": 0
                    },
                    {
                        "identifier": "style_guide",
                        "name": "å›å¤é£æ ¼æŒ‡å¯¼",
                        "content": "è¯·ä¿æŒå›å¤ç®€æ´æ˜äº†ï¼Œä½¿ç”¨å‹å–„çš„è¯­è°ƒï¼Œå¿…è¦æ—¶æä¾›è¯¦ç»†çš„è§£é‡Šã€‚",
                        "enabled": true,
                        "role": "system",
                        "injection_depth": 3,
                        "injection_order": 100,
                        "injection_position": 0
                    }
                ],
                "temperature": 0.8,
                "max_tokens": 2048,
                "top_p": 0.9,
                "top_k": 40,
                "frequency_penalty": 0.1,
                "presence_penalty": 0.1
            };
            
            processPreset(samplePreset, 'sample-preset.json');
        }

        // å¤„ç†é¢„è®¾
        function processPreset(presetData, fileName) {
            currentPreset = presetData;
            
            // æ˜¾ç¤ºé¢„è®¾åŸºæœ¬ä¿¡æ¯
            const presetInfo = document.getElementById('presetInfo');
            presetInfo.innerHTML = `
                <div class="status success">
                    âœ… é¢„è®¾åŠ è½½æˆåŠŸ: ${fileName}
                </div>
                <div><strong>é¢„è®¾åç§°:</strong> ${presetData.name || 'æœªå‘½å'}</div>
                <div><strong>æè¿°:</strong> ${presetData.description || 'æ— æè¿°'}</div>
                <div><strong>æç¤ºè¯æ•°é‡:</strong> ${presetData.prompts ? presetData.prompts.length : 0}</div>
            `;
            
            // æ‰§è¡Œæµ‹è¯•
            runV3Test(presetData);
            
            // æ˜¾ç¤ºç»“æœå®¹å™¨
            document.getElementById('resultsContainer').style.display = 'block';
        }

        // è¿è¡ŒV3æµ‹è¯•
        function runV3Test(presetData) {
            console.log('ğŸš€ å¼€å§‹V3æ¶æ„æµ‹è¯•', presetData);
            
            // æ¨¡æ‹ŸèŠå¤©å†å²
            const testChatHistory = [
                { role: 'user', content: 'ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±ã€‚', timestamp: Date.now() },
                { role: 'assistant', content: 'ä½ å¥½ï¼æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ã€‚', timestamp: Date.now() }
            ];
            
            // 1. ç»“æ„åˆ†æ
            const analysisResult = analyzePresetStructure(presetData);
            
            // 2. æ·±åº¦æ³¨å…¥å¤„ç†
            const processedMessages = performDepthInjection(testChatHistory, presetData);
            
            // 3. APIè½¬æ¢
            const geminiResult = convertToGemini(processedMessages, presetData);
            const openaiResult = convertToOpenAI(processedMessages, presetData);
            
            // 4. æ€§èƒ½æµ‹è¯•
            const performanceResult = performanceTest(testChatHistory, presetData);
            
            // ä¿å­˜ç»“æœ
            testResults = {
                analysis: analysisResult,
                processedMessages,
                gemini: geminiResult,
                openai: openaiResult,
                performance: performanceResult
            };
            
            // æ›´æ–°UI
            updateUI();
        }

        // ç»“æ„åˆ†æ
        function analyzePresetStructure(presetData) {
            const prompts = presetData.prompts || [];
            const enabledPrompts = prompts.filter(p => p.enabled !== false);
            
            // æŒ‰æ·±åº¦åˆ†ç»„
            const depthGroups = {};
            enabledPrompts.forEach(prompt => {
                const depth = prompt.injection_depth ?? 0;
                if (!depthGroups[depth]) depthGroups[depth] = [];
                depthGroups[depth].push(prompt);
            });
            
            // è§’è‰²åˆ†å¸ƒ
            const roleDistribution = {};
            enabledPrompts.forEach(prompt => {
                const role = prompt.role || 'system';
                roleDistribution[role] = (roleDistribution[role] || 0) + 1;
            });
            
            // å…¼å®¹æ€§æ£€æŸ¥
            const issues = [];
            const warnings = [];
            
            prompts.forEach((prompt, index) => {
                if (prompt.injection_depth === undefined) {
                    issues.push(`æç¤ºè¯${index + 1}ç¼ºå°‘injection_depthå­—æ®µ`);
                }
                if (prompt.injection_order === undefined) {
                    warnings.push(`æç¤ºè¯${index + 1}ç¼ºå°‘injection_orderå­—æ®µ`);
                }
                if (!prompt.role) {
                    warnings.push(`æç¤ºè¯${index + 1}ç¼ºå°‘roleå­—æ®µ`);
                }
            });
            
            return {
                totalPrompts: prompts.length,
                enabledPrompts: enabledPrompts.length,
                depthGroups,
                roleDistribution,
                issues,
                warnings,
                isCompatible: issues.length === 0
            };
        }

        // æ·±åº¦æ³¨å…¥å¤„ç†
        function performDepthInjection(chatHistory, presetData) {
            let messages = [...chatHistory];
            const prompts = presetData.prompts || [];
            const enabledPrompts = prompts.filter(p => p.enabled !== false);
            
            // æŒ‰æ·±åº¦å’Œä¼˜å…ˆçº§æ’åº
            enabledPrompts.sort((a, b) => {
                const depthDiff = (a.injection_depth ?? 0) - (b.injection_depth ?? 0);
                if (depthDiff !== 0) return depthDiff;
                return (a.injection_order ?? 100) - (b.injection_order ?? 100);
            });
            
            // æ³¨å…¥æç¤ºè¯
            enabledPrompts.forEach(prompt => {
                if (prompt.role === 'system' || !prompt.role) {
                    messages.unshift({
                        role: 'system',
                        content: prompt.content || '',
                        injected: true,
                        source: prompt.name || prompt.identifier,
                        depth: prompt.injection_depth ?? 0,
                        order: prompt.injection_order ?? 100
                    });
                }
            });
            
            return messages;
        }

        // Geminiè½¬æ¢
        function convertToGemini(messages, presetData) {
            const systemMessages = [];
            const contents = [];
            
            messages.forEach(msg => {
                if (msg.role === 'system') {
                    systemMessages.push(msg.content);
                } else {
                    contents.push({
                        role: msg.role === 'assistant' ? 'model' : 'user',
                        parts: [{ text: msg.content }]
                    });
                }
            });
            
            const request = {
                contents: contents,
                generationConfig: {
                    temperature: presetData.temperature ?? 0.8,
                    maxOutputTokens: presetData.max_tokens || presetData.max_output_tokens || 2048,
                    topP: presetData.top_p ?? 0.9,
                    topK: presetData.top_k ?? 40
                },
                safetySettings: [
                    { category: 'HARM_CATEGORY_HARASSMENT', threshold: 'BLOCK_NONE' },
                    { category: 'HARM_CATEGORY_HATE_SPEECH', threshold: 'BLOCK_NONE' },
                    { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', threshold: 'BLOCK_NONE' },
                    { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: 'BLOCK_NONE' }
                ]
            };
            
            if (systemMessages.length > 0) {
                request.systemInstruction = {
                    parts: systemMessages.map(text => ({ text }))
                };
            }
            
            return {
                endpoint: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent',
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer [API_KEY]',
                    'Content-Type': 'application/json'
                },
                body: request,
                bodySize: JSON.stringify(request).length,
                systemMessages: systemMessages.length,
                contents: contents.length
            };
        }

        // OpenAIè½¬æ¢
        function convertToOpenAI(messages, presetData) {
            const request = {
                model: 'gpt-3.5-turbo',
                messages: messages.map(msg => ({
                    role: msg.role,
                    content: msg.content
                })),
                temperature: presetData.temperature ?? 0.8,
                max_tokens: presetData.max_tokens ?? 2048,
                top_p: presetData.top_p ?? 1.0
            };
            
            if (presetData.frequency_penalty !== undefined) {
                request.frequency_penalty = presetData.frequency_penalty;
            }
            if (presetData.presence_penalty !== undefined) {
                request.presence_penalty = presetData.presence_penalty;
            }
            
            return {
                endpoint: 'https://api.openai.com/v1/chat/completions',
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer [API_KEY]',
                    'Content-Type': 'application/json'
                },
                body: request,
                bodySize: JSON.stringify(request).length,
                messages: request.messages.length
            };
        }

        // æ€§èƒ½æµ‹è¯•
        function performanceTest(chatHistory, presetData) {
            const iterations = 1000;
            
            const startTime = performance.now();
            
            for (let i = 0; i < iterations; i++) {
                // æ¨¡æ‹Ÿå®Œæ•´çš„å¤„ç†æµç¨‹
                const processed = performDepthInjection(chatHistory, presetData);
                convertToGemini(processed, presetData);
                convertToOpenAI(processed, presetData);
            }
            
            const endTime = performance.now();
            const totalTime = endTime - startTime;
            const avgTime = totalTime / iterations;
            
            return {
                iterations,
                totalTime: totalTime.toFixed(2),
                avgTime: avgTime.toFixed(4),
                rating: avgTime < 1 ? 'excellent' : avgTime < 5 ? 'good' : 'fair'
            };
        }

        // æ›´æ–°UI
        function updateUI() {
            if (!testResults) return;
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats();
            updateAnalysisTab();
            updateGeminiTab();
            updateOpenAITab();
            updatePerformanceTab();
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const stats = document.getElementById('statsContainer');
            const { analysis, gemini, openai, performance } = testResults;
            
            stats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${analysis.enabledPrompts}</div>
                    <div class="stat-label">å¯ç”¨æç¤ºè¯</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${Object.keys(analysis.depthGroups).length}</div>
                    <div class="stat-label">æ·±åº¦å±‚çº§</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${gemini.bodySize}</div>
                    <div class="stat-label">Geminiè¯·æ±‚å¤§å°(å­—èŠ‚)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${performance.avgTime}ms</div>
                    <div class="stat-label">å¹³å‡æ„å»ºæ—¶é—´</div>
                </div>
            `;
        }

        // æ›´æ–°åˆ†ææ ‡ç­¾é¡µ
        function updateAnalysisTab() {
            const content = document.getElementById('analysisContent');
            const { analysis } = testResults;
            
            let depthInfo = '';
            Object.keys(analysis.depthGroups).sort((a, b) => Number(a) - Number(b)).forEach(depth => {
                const prompts = analysis.depthGroups[depth];
                depthInfo += `<div><strong>æ·±åº¦${depth}:</strong> ${prompts.length}ä¸ªæç¤ºè¯</div>`;
                prompts.forEach(prompt => {
                    depthInfo += `<div style="margin-left: 20px; color: #666;">- ${prompt.name || prompt.identifier || 'æœªå‘½å'} (${prompt.role || 'system'})</div>`;
                });
            });
            
            let issuesHtml = '';
            if (analysis.issues.length > 0) {
                issuesHtml = '<div class="status error"><strong>å…¼å®¹æ€§é—®é¢˜:</strong><ul>' + 
                    analysis.issues.map(issue => `<li>${issue}</li>`).join('') + '</ul></div>';
            }
            
            let warningsHtml = '';
            if (analysis.warnings.length > 0) {
                warningsHtml = '<div class="status warning"><strong>æ”¹è¿›å»ºè®®:</strong><ul>' + 
                    analysis.warnings.map(warning => `<li>${warning}</li>`).join('') + '</ul></div>';
            }
            
            content.innerHTML = `
                <div class="status ${analysis.isCompatible ? 'success' : 'error'}">
                    ${analysis.isCompatible ? 'âœ… é¢„è®¾å®Œå…¨å…¼å®¹V3æ¶æ„' : 'âš ï¸ é¢„è®¾éœ€è¦è°ƒæ•´ä»¥å®Œå…¨å…¼å®¹'}
                </div>
                
                ${issuesHtml}
                ${warningsHtml}
                
                <h3>ğŸ“Š ç»“æ„åˆ†æ</h3>
                <div>æ€»æç¤ºè¯æ•°: ${analysis.totalPrompts}</div>
                <div>å¯ç”¨æç¤ºè¯æ•°: ${analysis.enabledPrompts}</div>
                
                <h3>ğŸ”¢ æ·±åº¦åˆ†å¸ƒ</h3>
                ${depthInfo}
                
                <h3>ğŸ‘¥ è§’è‰²åˆ†å¸ƒ</h3>
                ${Object.entries(analysis.roleDistribution).map(([role, count]) => 
                    `<div>${role}: ${count}ä¸ª</div>`
                ).join('')}
            `;
        }

        // æ›´æ–°Geminiæ ‡ç­¾é¡µ
        function updateGeminiTab() {
            const content = document.getElementById('geminiContent');
            const { gemini } = testResults;
            
            content.innerHTML = `
                <div class="status success">âœ… Geminiè½¬æ¢æˆåŠŸ</div>
                
                <h3>ğŸ“Š è½¬æ¢ç»Ÿè®¡</h3>
                <div>SystemInstructionéƒ¨åˆ†: ${gemini.systemMessages}æ¡</div>
                <div>Contentséƒ¨åˆ†: ${gemini.contents}æ¡</div>
                <div>è¯·æ±‚ä½“å¤§å°: ${gemini.bodySize}å­—èŠ‚</div>
                
                <h3>ğŸŒ APIè¯·æ±‚é…ç½®</h3>
                <div><strong>ç«¯ç‚¹:</strong> ${gemini.endpoint}</div>
                <div><strong>æ–¹æ³•:</strong> ${gemini.method}</div>
                <div><strong>è®¤è¯:</strong> Bearer Token</div>
                
                <h3>ğŸ“„ å®Œæ•´è¯·æ±‚ä½“</h3>
                <pre>${JSON.stringify(gemini.body, null, 2)}</pre>
            `;
        }

        // æ›´æ–°OpenAIæ ‡ç­¾é¡µ
        function updateOpenAITab() {
            const content = document.getElementById('openaiContent');
            const { openai } = testResults;
            
            content.innerHTML = `
                <div class="status success">âœ… OpenAIè½¬æ¢æˆåŠŸ</div>
                
                <h3>ğŸ“Š è½¬æ¢ç»Ÿè®¡</h3>
                <div>æ¶ˆæ¯æ•°é‡: ${openai.messages}æ¡</div>
                <div>è¯·æ±‚ä½“å¤§å°: ${openai.bodySize}å­—èŠ‚</div>
                
                <h3>ğŸŒ APIè¯·æ±‚é…ç½®</h3>
                <div><strong>ç«¯ç‚¹:</strong> ${openai.endpoint}</div>
                <div><strong>æ–¹æ³•:</strong> ${openai.method}</div>
                <div><strong>è®¤è¯:</strong> Bearer Token</div>
                
                <h3>ğŸ“„ å®Œæ•´è¯·æ±‚ä½“</h3>
                <pre>${JSON.stringify(openai.body, null, 2)}</pre>
            `;
        }

        // æ›´æ–°æ€§èƒ½æ ‡ç­¾é¡µ
        function updatePerformanceTab() {
            const content = document.getElementById('performanceContent');
            const { performance } = testResults;
            
            const ratingText = {
                'excellent': 'ğŸš€ æé€Ÿ',
                'good': 'âœ… ä¼˜ç§€', 
                'fair': 'âš ï¸ è‰¯å¥½'
            }[performance.rating];
            
            content.innerHTML = `
                <div class="status ${performance.rating === 'excellent' ? 'success' : 'info'}">
                    ${ratingText} - æ€§èƒ½è¡¨ç°${performance.rating === 'excellent' ? 'æä½³' : 'è‰¯å¥½'}
                </div>
                
                <h3>âš¡ æ€§èƒ½æŒ‡æ ‡</h3>
                <div>æµ‹è¯•æ¬¡æ•°: ${performance.iterations}æ¬¡</div>
                <div>æ€»è€—æ—¶: ${performance.totalTime}ms</div>
                <div>å¹³å‡è€—æ—¶: ${performance.avgTime}ms/æ¬¡</div>
                <div>å¤„ç†é€Ÿåº¦: ${(1000 / parseFloat(performance.avgTime)).toFixed(0)}æ¬¡/ç§’</div>
                
                <h3>ğŸ“ˆ æ€§èƒ½åˆ†æ</h3>
                <div>â€¢ æ¶ˆæ¯æ„å»ºé€Ÿåº¦ä¼˜ç§€ï¼Œæ»¡è¶³å®æ—¶åº”ç”¨éœ€æ±‚</div>
                <div>â€¢ å†…å­˜å ç”¨ä½ï¼Œé€‚åˆå¤§è§„æ¨¡éƒ¨ç½²</div>
                <div>â€¢ APIè½¬æ¢æ•ˆç‡é«˜ï¼Œæ”¯æŒé«˜å¹¶å‘å¤„ç†</div>
                
                <h3>ğŸ’¡ ä¼˜åŒ–å»ºè®®</h3>
                <div>â€¢ å½“å‰æ€§èƒ½è¡¨ç°å·²ç»å¾ˆå¥½ï¼Œæ— éœ€ç‰¹åˆ«ä¼˜åŒ–</div>
                <div>â€¢ å¯ä»¥è€ƒè™‘æ‰¹é‡å¤„ç†ä»¥è¿›ä¸€æ­¥æå‡ååé‡</div>
                <div>â€¢ å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨è¯·æ±‚ç¼“å­˜</div>
            `;
        }

        // æ¸…ç©ºç»“æœ
        function clearResults() {
            currentPreset = null;
            testResults = null;
            document.getElementById('presetInfo').innerHTML = '';
            document.getElementById('resultsContainer').style.display = 'none';
        }

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(type, message) {
            const presetInfo = document.getElementById('presetInfo');
            presetInfo.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ MessageBuilder V3 æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
        });
    </script>
</body>
</html>
